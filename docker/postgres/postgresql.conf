# PostgreSQL 配置文件 - 测试环境
# 此配置适用于开发和测试环境，已优化性能和远程访问

# 连接设置
listen_addresses = '*'                  # 监听所有网络接口
max_connections = 100                   # 最大连接数
superuser_reserved_connections = 3      # 保留给超级用户的连接

# 内存设置
shared_buffers = 256MB                  # 共享内存缓冲区
effective_cache_size = 1GB              # 有效缓存大小
maintenance_work_mem = 64MB             # 维护操作内存
work_mem = 16MB                         # 单个操作内存

# 查询规划
random_page_cost = 1.1                  # 随机页面成本（SSD优化）
effective_io_concurrency = 200          # 并发IO数量

# 日志设置
logging_collector = on                  # 启用日志收集
log_directory = 'pg_log'                # 日志目录
log_filename = 'postgresql-%Y-%m-%d_%H%M%S.log'
log_rotation_age = 1d                   # 日志轮转周期
log_rotation_size = 100MB               # 日志轮转大小
log_min_duration_statement = 1000       # 记录超过1秒的查询
log_line_prefix = '%t [%p]: [%l-1] user=%u,db=%d,app=%a,client=%h '
log_checkpoints = on
log_connections = on
log_disconnections = on
log_lock_waits = on
log_temp_files = 0
log_autovacuum_min_duration = 0

# WAL 设置
wal_level = replica                     # WAL 级别
max_wal_size = 1GB                      # 最大 WAL 大小
min_wal_size = 80MB                     # 最小 WAL 大小

# 检查点设置
checkpoint_timeout = 10min              # 检查点超时
checkpoint_completion_target = 0.9      # 检查点完成目标

# 自动清理
autovacuum = on                         # 启用自动清理
autovacuum_max_workers = 3              # 自动清理工作进程数

# 客户端连接默认值
timezone = 'Asia/Shanghai'              # 时区
lc_messages = 'en_US.utf8'             # 消息语言
lc_monetary = 'en_US.utf8'             # 货币格式
lc_numeric = 'en_US.utf8'              # 数字格式
lc_time = 'en_US.utf8'                 # 时间格式
default_text_search_config = 'pg_catalog.english'

# 性能优化
shared_preload_libraries = 'pg_stat_statements'  # 预加载统计扩展
track_activity_query_size = 2048        # 跟踪的查询大小
track_io_timing = on                    # 跟踪IO时间
