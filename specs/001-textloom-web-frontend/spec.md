# Feature Specification: TextLoom Web Frontend

**Feature Branch**: `001-textloom-web-frontend`  
**Created**: 2025-11-26  
**Status**: Draft  
**Input**: 基于 frontend/PRODUCT_DESIGN_V2.md 需求和 frontend/prototype.html 原型

## User Scenarios & Testing *(mandatory)*

### User Story 1 - 文档上传并生成视频 (Priority: P1) 🎯 MVP

用户可以上传 Markdown 文档,选择字幕模板,配置视频参数,并生成视频。这是产品的核心功能,必须在第一个版本实现。

**Why this priority**: 这是 TextLoom 的核心价值主张 - 将文档转换为视频。没有这个功能,产品就没有存在的意义。

**Independent Test**: 用户可以通过上传一个测试 Markdown 文件,选择任意字幕模板,点击"开始生成"按钮,然后在任务列表中看到新创建的任务,并在任务详情页面看到视频生成进度和最终的视频播放器,从而完全验证此功能。

**Acceptance Scenarios**:

1. **Given** 用户在首页, **When** 用户点击上传区域或拖拽 .md 文件到上传区域, **Then** 文件应该被成功上传,显示文件名、大小和上传成功提示
2. **Given** 用户已上传文件, **When** 用户选择一个字幕模板卡片, **Then** 该卡片应该显示选中状态(边框高亮),其他卡片取消选中
3. **Given** 用户已选择模板, **When** 用户点击"开始生成"按钮, **Then** 应该调用后端 API 创建任务,并跳转到任务详情页面
4. **Given** 任务详情页面加载, **When** 任务状态为 processing, **Then** 页面应该每 3 秒轮询一次后端 API,更新进度条和百分比显示
5. **Given** 任务状态变为 completed, **When** 轮询检测到状态变化, **Then** 页面应该停止轮询,显示视频播放器和"下载视频"按钮
6. **Given** 视频生成完成, **When** 用户点击播放按钮, **Then** 视频应该在播放器中正常播放,显示播放控制条

---

### User Story 2 - 查看和管理历史任务 (Priority: P2)

用户可以在任务列表页面查看所有历史任务,通过状态筛选任务,查看任务详情,取消正在进行的任务,以及删除已完成的任务。

**Why this priority**: 用户需要管理他们的视频生成任务。这是提升用户体验的关键功能,但不是 MVP 必需的(用户可以直接从首页创建任务并跳转到详情页)。

**Independent Test**: 用户可以导航到任务列表页面,看到之前创建的任务列表,点击状态标签筛选任务,点击任务卡片查看详情,点击"取消任务"按钮取消正在进行的任务,点击"删除"按钮删除已完成的任务,从而完全验证此功能。

**Acceptance Scenarios**:

1. **Given** 用户导航到任务列表页面, **When** 页面加载, **Then** 应该显示所有任务的列表,每个任务卡片显示文件名、状态、创建时间和进度
2. **Given** 任务列表加载, **When** 用户点击状态标签(全部/进行中/已完成/失败), **Then** 列表应该只显示对应状态的任务
3. **Given** 用户在任务列表, **When** 用户点击某个任务卡片, **Then** 应该跳转到该任务的详情页面
4. **Given** 用户在任务详情页面且任务状态为 processing, **When** 用户点击"取消任务"按钮, **Then** 应该调用后端 API 取消任务,任务状态变为 cancelled
5. **Given** 用户在任务列表且任务状态为 completed/failed, **When** 用户点击"删除"按钮, **Then** 应该弹出确认对话框,用户确认后调用后端 API 删除任务
6. **Given** 任务列表为空, **When** 页面加载, **Then** 应该显示空状态提示"还没有任何任务,去创建第一个吧!"和"开始创建"按钮

---

### User Story 3 - 查看数据统计和分析 (Priority: P3)

用户可以在统计页面查看总任务数、今日生成数、成功率和平均耗时等关键指标,以及任务状态分布饼图和最近 7 天生成趋势折线图。

**Why this priority**: 统计功能可以帮助用户了解他们的使用情况,但对于核心功能(生成视频)不是必需的。这是一个"锦上添花"的功能。

**Independent Test**: 用户可以导航到统计页面,看到统计卡片显示的数字指标(总任务数、今日生成数、成功率、平均耗时),看到饼图显示任务状态分布,看到折线图显示最近 7 天的生成趋势,从而完全验证此功能。

**Acceptance Scenarios**:

1. **Given** 用户导航到统计页面, **When** 页面加载, **Then** 应该显示 4 个统计卡片,包含总任务数、今日生成数、成功率和平均耗时
2. **Given** 统计页面加载, **When** 后端返回数据, **Then** 饼图应该显示任务状态分布(进行中/已完成/失败),每个扇区显示数量和百分比
3. **Given** 统计页面加载, **When** 后端返回数据, **Then** 折线图应该显示最近 7 天的任务生成数量趋势,X 轴为日期,Y 轴为数量
4. **Given** 用户查看统计数据, **When** 有新任务创建或完成, **Then** 统计数据应该在用户刷新页面后更新(无需实时更新)

---

### Edge Cases

- **文件大小限制**: 当用户上传超过 10MB 的 Markdown 文件时,系统应该显示错误提示"文件大小不能超过 10MB",拒绝上传
- **网络错误处理**: 当 API 请求失败(网络错误、超时、5xx 错误)时,系统应该显示友好的错误提示,例如"网络连接失败,请检查网络后重试",并提供"重试"按钮
- **空状态处理**: 当任务列表为空时,显示空状态插图和引导文案;当统计数据为空时,显示"暂无数据"提示
- **重复点击防护**: 当用户点击"开始生成"按钮后,按钮应该进入 loading 状态(显示 spinner),防止重复提交
- **轮询错误处理**: 当任务状态轮询失败 3 次后,停止轮询,显示错误提示"无法获取任务状态,请刷新页面重试"
- **视频播放失败**: 当视频 URL 无法加载或播放失败时,显示错误提示"视频加载失败,请稍后重试"
- **未选择模板**: 当用户未选择字幕模板就点击"开始生成"时,显示提示"请选择一个字幕模板"
- **文件格式错误**: 当用户上传非 .md 文件时,系统应该显示错误提示"仅支持 Markdown (.md) 文件"

## Requirements *(mandatory)*

### Functional Requirements

- **FR-001**: 系统必须支持用户通过点击上传区域或拖拽方式上传 Markdown (.md) 文件
- **FR-002**: 系统必须验证上传文件的格式(仅允许 .md 文件)和大小(不超过 10MB)
- **FR-003**: 系统必须显示至少 4 种字幕模板供用户选择(Hype、Minimalist、Explosive、Vibrant)
- **FR-004**: 用户必须能够在字幕模板卡片之间进行单选,系统应该清晰标识当前选中的模板
- **FR-005**: 系统必须在用户点击"开始生成"按钮后调用后端 API `/api/tasks/create` 创建视频生成任务
- **FR-006**: 系统必须在任务创建成功后跳转到任务详情页面,URL 格式为 `/tasks/:taskId`
- **FR-007**: 任务详情页面必须通过轮询方式(每 3 秒)调用后端 API `/api/tasks/:taskId/status` 获取任务状态和进度
- **FR-008**: 系统必须在任务详情页面显示实时进度条和百分比(0-100%)
- **FR-009**: 系统必须在任务状态变为 `completed` 时停止轮询,显示视频播放器
- **FR-010**: 系统必须支持在浏览器内播放生成的视频(HTML5 video 元素)
- **FR-011**: 系统必须提供"下载视频"按钮,允许用户下载生成的视频文件
- **FR-012**: 任务列表页面必须显示所有历史任务,包括文件名、状态、创建时间、进度等信息
- **FR-013**: 系统必须支持按任务状态筛选任务列表(全部/进行中/已完成/失败)
- **FR-014**: 系统必须允许用户取消状态为 `processing` 的任务,通过调用 API `/api/tasks/:taskId/cancel`
- **FR-015**: 系统必须允许用户删除状态为 `completed` 或 `failed` 的任务,需要用户确认后调用 API `/api/tasks/:taskId`
- **FR-016**: 统计页面必须显示总任务数、今日生成数、成功率和平均耗时 4 个关键指标
- **FR-017**: 统计页面必须显示任务状态分布饼图,包含进行中/已完成/失败的数量和百分比
- **FR-018**: 统计页面必须显示最近 7 天的任务生成趋势折线图
- **FR-019**: 系统必须在所有 API 请求失败时显示友好的错误提示,并提供重试选项
- **FR-020**: 系统必须防止用户重复提交表单(通过按钮 loading 状态)

### Key Entities *(include if feature involves data)*

- **VideoTask (视频任务)**: 表示一次视频生成任务,包含属性: id, filename, status (pending/processing/completed/failed/cancelled), progress (0-100), videoUrl, createdAt, completedAt
- **UploadedFile (上传文件)**: 表示用户上传的 Markdown 文件,包含属性: filename, size, uploadTime, fileUrl
- **SubtitleTemplate (字幕模板)**: 表示可选的字幕样式,包含属性: id, name (Hype/Minimalist/Explosive/Vibrant), previewImage, description
- **ScriptContent (脚本内容)**: 表示 AI 生成的视频脚本,包含属性: taskId, scriptText, style, generatedAt

## Success Criteria *(mandatory)*

### Measurable Outcomes

- **SC-001**: 用户可以在 30 秒内完成文件上传和任务创建流程(从选择文件到任务创建成功)
- **SC-002**: 任务状态轮询延迟不超过 3 秒,用户可以在 3 秒内看到最新的进度更新
- **SC-003**: 视频播放器加载时间不超过 5 秒,用户点击播放后可以立即观看视频
- **SC-004**: 90% 的用户可以在第一次尝试时成功创建视频任务(无错误提示)
- **SC-005**: 任务列表页面加载时间不超过 3 秒,即使有 100+ 个历史任务
- **SC-006**: 统计页面的图表渲染时间不超过 2 秒
- **SC-007**: 系统在网络错误时可以在 1 秒内显示错误提示,95% 的用户理解错误原因
- **SC-008**: 用户可以通过状态筛选在 5 秒内找到目标任务
- **SC-009**: 取消任务的响应时间不超过 2 秒,任务状态立即更新为 cancelled
- **SC-010**: 删除任务后,任务列表立即刷新(不超过 1 秒)
