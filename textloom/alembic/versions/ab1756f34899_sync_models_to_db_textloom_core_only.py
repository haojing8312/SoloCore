"""sync models to db (textloom_core only)

Revision ID: ab1756f34899
Revises:
Create Date: 2025-08-11 17:57:36.351915

"""

from typing import Sequence, Union

import sqlalchemy as sa
from sqlalchemy.dialects import postgresql

from alembic import op

# revision identifiers, used by Alembic.
revision: str = "ab1756f34899"
down_revision: Union[str, Sequence[str], None] = None
branch_labels: Union[str, Sequence[str], None] = None
depends_on: Union[str, Sequence[str], None] = None


def upgrade() -> None:
    """Upgrade schema."""
    # ### commands auto generated by Alembic - please adjust! ###
    # Skip dropping schema_migrations table if it doesn't exist
    # op.drop_table("schema_migrations", schema="textloom_core")
    op.alter_column(
        "material_analyses",
        "task_id",
        existing_type=sa.UUID(),
        comment="关联任务ID",
        existing_nullable=False,
        schema="textloom_core",
    )
    op.alter_column(
        "material_analyses",
        "media_item_id",
        existing_type=sa.UUID(),
        comment="关联媒体项目ID",
        existing_nullable=True,
        schema="textloom_core",
    )
    op.alter_column(
        "material_analyses",
        "file_url",
        existing_type=sa.TEXT(),
        comment="文件URL",
        existing_nullable=False,
        schema="textloom_core",
    )
    op.alter_column(
        "material_analyses",
        "file_type",
        existing_type=sa.VARCHAR(length=50),
        comment="文件类型",
        existing_nullable=False,
        schema="textloom_core",
    )
    op.alter_column(
        "material_analyses",
        "file_size",
        existing_type=sa.INTEGER(),
        comment="文件大小",
        existing_nullable=True,
        schema="textloom_core",
    )
    op.alter_column(
        "material_analyses",
        "status",
        existing_type=sa.VARCHAR(length=50),
        comment="分析状态",
        existing_nullable=False,
        existing_server_default=sa.text("'pending'::character varying"),
        schema="textloom_core",
    )
    op.alter_column(
        "material_analyses",
        "ai_description",
        existing_type=sa.TEXT(),
        comment="AI生成的描述",
        existing_nullable=True,
        schema="textloom_core",
    )
    op.alter_column(
        "material_analyses",
        "extracted_text",
        existing_type=sa.TEXT(),
        comment="提取的文本内容",
        existing_nullable=True,
        schema="textloom_core",
    )
    op.alter_column(
        "material_analyses",
        "key_objects",
        existing_type=postgresql.JSON(astext_type=sa.Text()),
        comment="识别的关键对象",
        existing_nullable=True,
        existing_server_default=sa.text("'[]'::json"),
        schema="textloom_core",
    )
    op.alter_column(
        "material_analyses",
        "emotional_tone",
        existing_type=sa.VARCHAR(length=100),
        comment="情感基调",
        existing_nullable=True,
        schema="textloom_core",
    )
    op.alter_column(
        "material_analyses",
        "visual_style",
        existing_type=sa.VARCHAR(length=100),
        comment="视觉风格",
        existing_nullable=True,
        schema="textloom_core",
    )
    op.alter_column(
        "material_analyses",
        "quality_score",
        existing_type=sa.REAL(),
        type_=sa.Float(),
        comment="质量评分",
        existing_nullable=True,
        schema="textloom_core",
    )
    op.alter_column(
        "material_analyses",
        "quality_level",
        existing_type=sa.VARCHAR(length=20),
        comment="质量级别",
        existing_nullable=True,
        schema="textloom_core",
    )
    op.alter_column(
        "material_analyses",
        "usage_suggestions",
        existing_type=postgresql.JSON(astext_type=sa.Text()),
        comment="使用建议",
        existing_nullable=True,
        existing_server_default=sa.text("'[]'::json"),
        schema="textloom_core",
    )
    op.alter_column(
        "material_analyses",
        "duration",
        existing_type=sa.INTEGER(),
        comment="视频时长(秒)",
        existing_nullable=True,
        schema="textloom_core",
    )
    op.alter_column(
        "material_analyses",
        "fps",
        existing_type=sa.REAL(),
        type_=sa.Float(),
        comment="帧率",
        existing_nullable=True,
        schema="textloom_core",
    )
    op.alter_column(
        "material_analyses",
        "resolution",
        existing_type=sa.VARCHAR(length=20),
        comment="分辨率",
        existing_nullable=True,
        schema="textloom_core",
    )
    op.alter_column(
        "material_analyses",
        "key_frames",
        existing_type=postgresql.JSON(astext_type=sa.Text()),
        comment="关键帧信息",
        existing_nullable=True,
        existing_server_default=sa.text("'[]'::json"),
        schema="textloom_core",
    )
    op.alter_column(
        "material_analyses",
        "dimensions",
        existing_type=sa.VARCHAR(length=20),
        comment="图像尺寸",
        existing_nullable=True,
        schema="textloom_core",
    )
    op.alter_column(
        "material_analyses",
        "color_palette",
        existing_type=postgresql.JSON(astext_type=sa.Text()),
        comment="主要颜色",
        existing_nullable=True,
        existing_server_default=sa.text("'[]'::json"),
        schema="textloom_core",
    )
    op.alter_column(
        "material_analyses",
        "processing_time",
        existing_type=sa.REAL(),
        type_=sa.Float(),
        comment="处理时间(秒)",
        existing_nullable=True,
        schema="textloom_core",
    )
    op.alter_column(
        "material_analyses",
        "model_version",
        existing_type=sa.VARCHAR(length=50),
        comment="使用的模型版本",
        existing_nullable=True,
        schema="textloom_core",
    )
    op.alter_column(
        "material_analyses",
        "error_message",
        existing_type=sa.TEXT(),
        comment="错误信息",
        existing_nullable=True,
        schema="textloom_core",
    )
    op.alter_column(
        "material_analyses",
        "created_at",
        existing_type=postgresql.TIMESTAMP(),
        comment="创建时间",
        existing_nullable=False,
        existing_server_default=sa.text("CURRENT_TIMESTAMP"),
        schema="textloom_core",
    )
    op.alter_column(
        "material_analyses",
        "updated_at",
        existing_type=postgresql.TIMESTAMP(),
        nullable=True,
        comment="更新时间",
        existing_server_default=sa.text("CURRENT_TIMESTAMP"),
        schema="textloom_core",
    )
    op.create_unique_constraint(
        "uq_material_analyses_task_file",
        "material_analyses",
        ["task_id", "file_url"],
        schema="textloom_core",
    )
    op.create_foreign_key(
        None,
        "material_analyses",
        "media_items",
        ["media_item_id"],
        ["id"],
        source_schema="textloom_core",
        referent_schema="textloom_core",
    )
    op.alter_column(
        "media_items",
        "task_id",
        existing_type=sa.UUID(),
        comment="关联任务ID",
        existing_nullable=False,
        schema="textloom_core",
    )
    op.alter_column(
        "media_items",
        "filename",
        existing_type=sa.VARCHAR(length=255),
        comment="文件名",
        existing_nullable=False,
        schema="textloom_core",
    )
    op.alter_column(
        "media_items",
        "file_url",
        existing_type=sa.TEXT(),
        comment="文件URL",
        existing_nullable=False,
        schema="textloom_core",
    )
    op.alter_column(
        "media_items",
        "file_size",
        existing_type=sa.BIGINT(),
        type_=sa.Integer(),
        comment="文件大小(字节)",
        existing_nullable=True,
        schema="textloom_core",
    )
    op.alter_column(
        "media_items",
        "media_type",
        existing_type=sa.VARCHAR(length=50),
        comment="媒体类型",
        existing_nullable=False,
        schema="textloom_core",
    )
    op.alter_column(
        "media_items",
        "mime_type",
        existing_type=sa.VARCHAR(length=100),
        comment="MIME类型",
        existing_nullable=True,
        schema="textloom_core",
    )
    op.alter_column(
        "media_items",
        "duration",
        existing_type=sa.REAL(),
        type_=sa.Integer(),
        comment="时长(秒)",
        existing_nullable=True,
        schema="textloom_core",
    )
    op.alter_column(
        "media_items",
        "created_at",
        existing_type=postgresql.TIMESTAMP(),
        comment="创建时间",
        existing_nullable=False,
        existing_server_default=sa.text("CURRENT_TIMESTAMP"),
        schema="textloom_core",
    )
    op.alter_column(
        "personas",
        "name",
        existing_type=sa.VARCHAR(length=100),
        comment="人设名称",
        existing_nullable=False,
        schema="textloom_core",
    )
    op.alter_column(
        "personas",
        "persona_type",
        existing_type=sa.VARCHAR(length=50),
        comment="人设类型",
        existing_nullable=False,
        schema="textloom_core",
    )
    op.alter_column(
        "personas",
        "style",
        existing_type=sa.VARCHAR(length=100),
        comment="风格",
        existing_nullable=True,
        schema="textloom_core",
    )
    op.alter_column(
        "personas",
        "target_audience",
        existing_type=sa.VARCHAR(length=100),
        comment="目标受众",
        existing_nullable=True,
        schema="textloom_core",
    )
    op.alter_column(
        "personas",
        "characteristics",
        existing_type=sa.TEXT(),
        comment="特征描述",
        existing_nullable=True,
        schema="textloom_core",
    )
    op.alter_column(
        "personas",
        "tone",
        existing_type=sa.VARCHAR(length=50),
        comment="语调",
        existing_nullable=True,
        schema="textloom_core",
    )
    op.alter_column(
        "personas",
        "keywords",
        existing_type=sa.TEXT(),
        comment="关键词",
        existing_nullable=True,
        schema="textloom_core",
    )
    op.alter_column(
        "personas",
        "custom_prompts",
        existing_type=postgresql.JSONB(astext_type=sa.Text()),
        type_=sa.JSON(),
        comment="自定义提示词",
        existing_nullable=True,
        existing_server_default=sa.text("'{}'::jsonb"),
        schema="textloom_core",
    )
    op.alter_column(
        "personas",
        "is_preset",
        existing_type=sa.BOOLEAN(),
        nullable=True,
        comment="是否为预设人设",
        existing_server_default=sa.text("false"),
        schema="textloom_core",
    )
    op.alter_column(
        "personas",
        "created_at",
        existing_type=postgresql.TIMESTAMP(),
        comment="创建时间",
        existing_nullable=False,
        existing_server_default=sa.text("CURRENT_TIMESTAMP"),
        schema="textloom_core",
    )
    op.alter_column(
        "personas",
        "updated_at",
        existing_type=postgresql.TIMESTAMP(),
        comment="更新时间",
        existing_nullable=False,
        existing_server_default=sa.text("CURRENT_TIMESTAMP"),
        schema="textloom_core",
    )
    op.alter_column(
        "prompt_templates",
        "template_key",
        existing_type=sa.VARCHAR(length=255),
        type_=sa.String(length=100),
        comment="模板键名",
        existing_nullable=False,
        schema="textloom_core",
    )
    op.alter_column(
        "prompt_templates",
        "template_content",
        existing_type=sa.TEXT(),
        comment="模板内容",
        existing_nullable=False,
        schema="textloom_core",
    )
    op.alter_column(
        "prompt_templates",
        "description",
        existing_type=sa.TEXT(),
        comment="模板描述",
        existing_nullable=True,
        schema="textloom_core",
    )
    op.alter_column(
        "prompt_templates",
        "category",
        existing_type=sa.VARCHAR(length=50),
        comment="模板分类",
        existing_nullable=True,
        schema="textloom_core",
    )
    op.alter_column(
        "prompt_templates",
        "template_type",
        existing_type=sa.VARCHAR(length=50),
        comment="模板类型",
        existing_nullable=True,
        schema="textloom_core",
    )
    op.alter_column(
        "prompt_templates",
        "template_style",
        existing_type=sa.VARCHAR(length=50),
        comment="模板风格",
        existing_nullable=True,
        schema="textloom_core",
    )
    op.alter_column(
        "prompt_templates",
        "created_at",
        existing_type=postgresql.TIMESTAMP(),
        comment="创建时间",
        existing_nullable=False,
        existing_server_default=sa.text("CURRENT_TIMESTAMP"),
        schema="textloom_core",
    )
    op.alter_column(
        "script_contents",
        "task_id",
        existing_type=sa.UUID(),
        comment="关联任务ID",
        existing_nullable=False,
        schema="textloom_core",
    )
    op.alter_column(
        "script_contents",
        "persona_id",
        existing_type=sa.UUID(),
        comment="关联人设ID",
        existing_nullable=True,
        schema="textloom_core",
    )
    op.alter_column(
        "script_contents",
        "script_style",
        existing_type=sa.VARCHAR(length=100),
        type_=sa.String(length=50),
        comment="脚本风格",
        existing_nullable=True,
        schema="textloom_core",
    )
    op.alter_column(
        "script_contents",
        "generation_status",
        existing_type=sa.VARCHAR(length=50),
        comment="生成状态",
        existing_nullable=False,
        existing_server_default=sa.text("'pending'::character varying"),
        schema="textloom_core",
    )
    op.alter_column(
        "script_contents",
        "titles",
        existing_type=postgresql.JSONB(astext_type=sa.Text()),
        type_=sa.JSON(),
        comment="标题列表",
        existing_nullable=True,
        schema="textloom_core",
    )
    op.alter_column(
        "script_contents",
        "narration",
        existing_type=postgresql.JSONB(astext_type=sa.Text()),
        type_=sa.Text(),
        comment="旁白内容",
        existing_nullable=True,
        schema="textloom_core",
    )
    op.alter_column(
        "script_contents",
        "material_mapping",
        existing_type=postgresql.JSONB(astext_type=sa.Text()),
        type_=sa.JSON(),
        comment="素材映射",
        existing_nullable=True,
        schema="textloom_core",
    )
    op.alter_column(
        "script_contents",
        "description",
        existing_type=sa.TEXT(),
        comment="脚本描述",
        existing_nullable=True,
        schema="textloom_core",
    )
    op.alter_column(
        "script_contents",
        "tags",
        existing_type=postgresql.JSON(astext_type=sa.Text()),
        comment="标签",
        existing_nullable=True,
        existing_server_default=sa.text("'[]'::json"),
        schema="textloom_core",
    )
    op.alter_column(
        "script_contents",
        "estimated_duration",
        existing_type=sa.INTEGER(),
        comment="预计时长(秒)",
        existing_nullable=True,
        schema="textloom_core",
    )
    op.alter_column(
        "script_contents",
        "word_count",
        existing_type=sa.INTEGER(),
        comment="字数",
        existing_nullable=True,
        schema="textloom_core",
    )
    op.alter_column(
        "script_contents",
        "material_count",
        existing_type=sa.INTEGER(),
        comment="素材数量",
        existing_nullable=True,
        schema="textloom_core",
    )
    op.alter_column(
        "script_contents",
        "generation_prompt",
        existing_type=sa.TEXT(),
        comment="生成提示词",
        existing_nullable=True,
        schema="textloom_core",
    )
    op.alter_column(
        "script_contents",
        "ai_response",
        existing_type=sa.TEXT(),
        comment="AI响应",
        existing_nullable=True,
        schema="textloom_core",
    )
    op.alter_column(
        "script_contents",
        "error_message",
        existing_type=sa.TEXT(),
        comment="错误信息",
        existing_nullable=True,
        schema="textloom_core",
    )
    op.alter_column(
        "script_contents",
        "created_at",
        existing_type=postgresql.TIMESTAMP(),
        comment="创建时间",
        existing_nullable=False,
        existing_server_default=sa.text("CURRENT_TIMESTAMP"),
        schema="textloom_core",
    )
    op.alter_column(
        "script_contents",
        "updated_at",
        existing_type=postgresql.TIMESTAMP(),
        nullable=True,
        comment="更新时间",
        existing_server_default=sa.text("CURRENT_TIMESTAMP"),
        schema="textloom_core",
    )
    op.alter_column(
        "script_contents",
        "generated_at",
        existing_type=postgresql.TIMESTAMP(),
        comment="生成时间",
        existing_nullable=True,
        schema="textloom_core",
    )
    op.alter_column(
        "sub_video_tasks",
        "parent_task_id",
        existing_type=sa.UUID(),
        comment="父任务ID",
        existing_nullable=False,
        schema="textloom_core",
    )
    op.alter_column(
        "sub_video_tasks",
        "video_index",
        existing_type=sa.INTEGER(),
        nullable=False,
        comment="视频索引",
        schema="textloom_core",
    )
    op.alter_column(
        "sub_video_tasks",
        "status",
        existing_type=sa.VARCHAR(length=50),
        comment="子任务状态",
        existing_nullable=False,
        existing_server_default=sa.text("'pending'::character varying"),
        schema="textloom_core",
    )
    op.alter_column(
        "sub_video_tasks",
        "video_url",
        existing_type=sa.TEXT(),
        comment="生成的视频URL",
        existing_nullable=True,
        schema="textloom_core",
    )
    op.alter_column(
        "sub_video_tasks",
        "course_media_id",
        existing_type=sa.INTEGER(),
        comment="视频合成服务的媒体ID",
        existing_nullable=True,
        schema="textloom_core",
    )
    op.alter_column(
        "sub_video_tasks",
        "error_message",
        existing_type=sa.TEXT(),
        comment="错误信息",
        existing_nullable=True,
        schema="textloom_core",
    )
    op.alter_column(
        "sub_video_tasks",
        "created_at",
        existing_type=postgresql.TIMESTAMP(),
        comment="创建时间",
        existing_nullable=False,
        existing_server_default=sa.text("CURRENT_TIMESTAMP"),
        schema="textloom_core",
    )
    op.alter_column(
        "sub_video_tasks",
        "updated_at",
        existing_type=postgresql.TIMESTAMP(),
        nullable=True,
        comment="更新时间",
        existing_server_default=sa.text("CURRENT_TIMESTAMP"),
        schema="textloom_core",
    )
    op.alter_column(
        "sub_video_tasks",
        "completed_at",
        existing_type=postgresql.TIMESTAMP(),
        comment="完成时间",
        existing_nullable=True,
        schema="textloom_core",
    )
    op.alter_column(
        "tasks",
        "title",
        existing_type=sa.VARCHAR(length=255),
        comment="任务标题",
        existing_nullable=False,
        schema="textloom_core",
    )
    op.alter_column(
        "tasks",
        "description",
        existing_type=sa.TEXT(),
        comment="任务描述",
        existing_nullable=True,
        schema="textloom_core",
    )
    op.alter_column(
        "tasks",
        "creator_id",
        existing_type=sa.VARCHAR(length=100),
        comment="创建者ID",
        existing_nullable=True,
        schema="textloom_core",
    )
    op.alter_column(
        "tasks",
        "task_type",
        existing_type=sa.VARCHAR(length=50),
        comment="任务类型",
        existing_nullable=False,
        schema="textloom_core",
    )
    op.alter_column(
        "tasks",
        "status",
        existing_type=sa.VARCHAR(length=50),
        comment="任务状态",
        existing_nullable=False,
        existing_server_default=sa.text("'pending'::character varying"),
        schema="textloom_core",
    )
    op.alter_column(
        "tasks",
        "progress",
        existing_type=sa.INTEGER(),
        nullable=False,
        comment="任务进度",
        existing_server_default=sa.text("0"),
        schema="textloom_core",
    )
    op.alter_column(
        "tasks",
        "created_at",
        existing_type=postgresql.TIMESTAMP(),
        comment="创建时间",
        existing_nullable=False,
        existing_server_default=sa.text("CURRENT_TIMESTAMP"),
        schema="textloom_core",
    )
    op.alter_column(
        "tasks",
        "updated_at",
        existing_type=postgresql.TIMESTAMP(),
        nullable=True,
        comment="更新时间",
        existing_server_default=sa.text("CURRENT_TIMESTAMP"),
        schema="textloom_core",
    )
    op.alter_column(
        "tasks",
        "started_at",
        existing_type=postgresql.TIMESTAMP(),
        comment="开始时间",
        existing_nullable=True,
        schema="textloom_core",
    )
    op.alter_column(
        "tasks",
        "completed_at",
        existing_type=postgresql.TIMESTAMP(),
        comment="完成时间",
        existing_nullable=True,
        schema="textloom_core",
    )
    op.alter_column(
        "tasks",
        "error_message",
        existing_type=sa.TEXT(),
        comment="错误信息",
        existing_nullable=True,
        schema="textloom_core",
    )
    op.alter_column(
        "tasks",
        "celery_task_id",
        existing_type=sa.VARCHAR(length=255),
        comment="Celery任务ID",
        existing_nullable=True,
        schema="textloom_core",
    )
    op.alter_column(
        "tasks",
        "worker_name",
        existing_type=sa.VARCHAR(length=100),
        comment="执行任务的Worker名称",
        existing_nullable=True,
        schema="textloom_core",
    )
    op.alter_column(
        "tasks",
        "retry_count",
        existing_type=sa.INTEGER(),
        comment="重试次数",
        existing_nullable=True,
        existing_server_default=sa.text("0"),
        schema="textloom_core",
    )
    op.alter_column(
        "tasks",
        "max_retries",
        existing_type=sa.INTEGER(),
        comment="最大重试次数",
        existing_nullable=True,
        existing_server_default=sa.text("3"),
        schema="textloom_core",
    )
    op.alter_column(
        "tasks",
        "error_traceback",
        existing_type=sa.TEXT(),
        comment="详细错误堆栈信息",
        existing_nullable=True,
        schema="textloom_core",
    )
    op.alter_column(
        "tasks",
        "script_title",
        existing_type=sa.TEXT(),
        comment="脚本标题",
        existing_nullable=True,
        schema="textloom_core",
    )
    op.alter_column(
        "tasks",
        "script_description",
        existing_type=sa.TEXT(),
        comment="脚本描述",
        existing_nullable=True,
        schema="textloom_core",
    )
    op.alter_column(
        "tasks",
        "script_narration",
        existing_type=sa.TEXT(),
        comment="脚本旁白内容",
        existing_nullable=True,
        schema="textloom_core",
    )
    op.alter_column(
        "tasks",
        "script_tags",
        existing_type=postgresql.JSON(astext_type=sa.Text()),
        comment="脚本标签",
        existing_nullable=True,
        existing_server_default=sa.text("'[]'::json"),
        schema="textloom_core",
    )
    op.alter_column(
        "tasks",
        "script_estimated_duration",
        existing_type=sa.INTEGER(),
        comment="脚本预计时长(秒)",
        existing_nullable=True,
        schema="textloom_core",
    )
    op.alter_column(
        "tasks",
        "script_word_count",
        existing_type=sa.INTEGER(),
        comment="脚本字数",
        existing_nullable=True,
        schema="textloom_core",
    )
    op.alter_column(
        "tasks",
        "script_material_count",
        existing_type=sa.INTEGER(),
        comment="脚本使用素材数量",
        existing_nullable=True,
        schema="textloom_core",
    )
    op.alter_column(
        "tasks",
        "video_url",
        existing_type=sa.TEXT(),
        comment="生成的视频URL",
        existing_nullable=True,
        schema="textloom_core",
    )
    op.alter_column(
        "tasks",
        "thumbnail_url",
        existing_type=sa.TEXT(),
        comment="视频缩略图URL",
        existing_nullable=True,
        schema="textloom_core",
    )
    op.alter_column(
        "tasks",
        "video_duration",
        existing_type=sa.INTEGER(),
        comment="视频实际时长(秒)",
        existing_nullable=True,
        schema="textloom_core",
    )
    op.alter_column(
        "tasks",
        "video_file_size",
        existing_type=sa.INTEGER(),
        comment="视频文件大小(字节)",
        existing_nullable=True,
        schema="textloom_core",
    )
    op.alter_column(
        "tasks",
        "video_quality",
        existing_type=sa.VARCHAR(length=50),
        comment="视频质量",
        existing_nullable=True,
        schema="textloom_core",
    )
    op.alter_column(
        "tasks",
        "course_media_id",
        existing_type=sa.INTEGER(),
        comment="视频合成服务的媒体ID",
        existing_nullable=True,
        schema="textloom_core",
    )
    op.alter_column(
        "tasks",
        "is_multi_video_task",
        existing_type=sa.BOOLEAN(),
        comment="是否为多视频任务",
        existing_nullable=True,
        existing_server_default=sa.text("false"),
        schema="textloom_core",
    )
    op.alter_column(
        "tasks",
        "multi_video_urls",
        existing_type=postgresql.JSON(astext_type=sa.Text()),
        comment="多个视频URL列表",
        existing_nullable=True,
        existing_server_default=sa.text("'[]'::json"),
        schema="textloom_core",
    )
    op.alter_column(
        "tasks",
        "multi_video_count",
        existing_type=sa.INTEGER(),
        comment="视频生成数量",
        existing_nullable=True,
        existing_server_default=sa.text("1"),
        schema="textloom_core",
    )
    op.alter_column(
        "tasks",
        "sub_videos_completed",
        existing_type=sa.INTEGER(),
        comment="已完成的子视频数量",
        existing_nullable=True,
        existing_server_default=sa.text("0"),
        schema="textloom_core",
    )
    op.alter_column(
        "tasks",
        "multi_video_results",
        existing_type=postgresql.JSON(astext_type=sa.Text()),
        comment="多视频生成结果列表",
        existing_nullable=True,
        existing_server_default=sa.text("'[]'::json"),
        schema="textloom_core",
    )
    op.alter_column(
        "tasks",
        "file_path",
        existing_type=sa.VARCHAR(),
        type_=sa.Text(),
        comment="文件路径",
        existing_nullable=True,
        schema="textloom_core",
    )
    op.alter_column(
        "tasks",
        "source_file",
        existing_type=sa.VARCHAR(),
        type_=sa.Text(),
        comment="源文件路径",
        existing_nullable=True,
        schema="textloom_core",
    )
    op.alter_column(
        "tasks",
        "workspace_dir",
        existing_type=sa.VARCHAR(),
        type_=sa.Text(),
        comment="工作目录",
        existing_nullable=True,
        schema="textloom_core",
    )
    op.alter_column(
        "tasks",
        "script_style_type",
        existing_type=sa.VARCHAR(length=50),
        comment="脚本风格类型",
        existing_nullable=True,
        schema="textloom_core",
    )
    op.alter_column(
        "video_projects",
        "title",
        existing_type=sa.VARCHAR(length=255),
        comment="项目标题",
        existing_nullable=False,
        schema="textloom_core",
    )
    op.alter_column(
        "video_projects",
        "status",
        existing_type=sa.VARCHAR(length=50),
        comment="项目状态",
        existing_nullable=False,
        existing_server_default=sa.text("'created'::character varying"),
        schema="textloom_core",
    )
    op.alter_column(
        "video_projects",
        "video_url",
        existing_type=sa.TEXT(),
        comment="视频URL",
        existing_nullable=True,
        schema="textloom_core",
    )
    op.alter_column(
        "video_projects",
        "created_at",
        existing_type=postgresql.TIMESTAMP(),
        comment="创建时间",
        existing_nullable=False,
        existing_server_default=sa.text("CURRENT_TIMESTAMP"),
        schema="textloom_core",
    )
    op.alter_column(
        "video_projects",
        "updated_at",
        existing_type=postgresql.TIMESTAMP(),
        comment="更新时间",
        existing_nullable=False,
        existing_server_default=sa.text("CURRENT_TIMESTAMP"),
        schema="textloom_core",
    )
    # ### end Alembic commands ###


def downgrade() -> None:
    """Downgrade schema."""
    # ### commands auto generated by Alembic - please adjust! ###
    op.alter_column(
        "video_projects",
        "updated_at",
        existing_type=postgresql.TIMESTAMP(),
        comment=None,
        existing_comment="更新时间",
        existing_nullable=False,
        existing_server_default=sa.text("CURRENT_TIMESTAMP"),
        schema="textloom_core",
    )
    op.alter_column(
        "video_projects",
        "created_at",
        existing_type=postgresql.TIMESTAMP(),
        comment=None,
        existing_comment="创建时间",
        existing_nullable=False,
        existing_server_default=sa.text("CURRENT_TIMESTAMP"),
        schema="textloom_core",
    )
    op.alter_column(
        "video_projects",
        "video_url",
        existing_type=sa.TEXT(),
        comment=None,
        existing_comment="视频URL",
        existing_nullable=True,
        schema="textloom_core",
    )
    op.alter_column(
        "video_projects",
        "status",
        existing_type=sa.VARCHAR(length=50),
        comment=None,
        existing_comment="项目状态",
        existing_nullable=False,
        existing_server_default=sa.text("'created'::character varying"),
        schema="textloom_core",
    )
    op.alter_column(
        "video_projects",
        "title",
        existing_type=sa.VARCHAR(length=255),
        comment=None,
        existing_comment="项目标题",
        existing_nullable=False,
        schema="textloom_core",
    )
    op.alter_column(
        "tasks",
        "script_style_type",
        existing_type=sa.VARCHAR(length=50),
        comment=None,
        existing_comment="脚本风格类型",
        existing_nullable=True,
        schema="textloom_core",
    )
    op.alter_column(
        "tasks",
        "workspace_dir",
        existing_type=sa.Text(),
        type_=sa.VARCHAR(),
        comment=None,
        existing_comment="工作目录",
        existing_nullable=True,
        schema="textloom_core",
    )
    op.alter_column(
        "tasks",
        "source_file",
        existing_type=sa.Text(),
        type_=sa.VARCHAR(),
        comment=None,
        existing_comment="源文件路径",
        existing_nullable=True,
        schema="textloom_core",
    )
    op.alter_column(
        "tasks",
        "file_path",
        existing_type=sa.Text(),
        type_=sa.VARCHAR(),
        comment=None,
        existing_comment="文件路径",
        existing_nullable=True,
        schema="textloom_core",
    )
    op.alter_column(
        "tasks",
        "multi_video_results",
        existing_type=postgresql.JSON(astext_type=sa.Text()),
        comment=None,
        existing_comment="多视频生成结果列表",
        existing_nullable=True,
        existing_server_default=sa.text("'[]'::json"),
        schema="textloom_core",
    )
    op.alter_column(
        "tasks",
        "sub_videos_completed",
        existing_type=sa.INTEGER(),
        comment=None,
        existing_comment="已完成的子视频数量",
        existing_nullable=True,
        existing_server_default=sa.text("0"),
        schema="textloom_core",
    )
    op.alter_column(
        "tasks",
        "multi_video_count",
        existing_type=sa.INTEGER(),
        comment=None,
        existing_comment="视频生成数量",
        existing_nullable=True,
        existing_server_default=sa.text("1"),
        schema="textloom_core",
    )
    op.alter_column(
        "tasks",
        "multi_video_urls",
        existing_type=postgresql.JSON(astext_type=sa.Text()),
        comment=None,
        existing_comment="多个视频URL列表",
        existing_nullable=True,
        existing_server_default=sa.text("'[]'::json"),
        schema="textloom_core",
    )
    op.alter_column(
        "tasks",
        "is_multi_video_task",
        existing_type=sa.BOOLEAN(),
        comment=None,
        existing_comment="是否为多视频任务",
        existing_nullable=True,
        existing_server_default=sa.text("false"),
        schema="textloom_core",
    )
    op.alter_column(
        "tasks",
        "course_media_id",
        existing_type=sa.INTEGER(),
        comment=None,
        existing_comment="视频合成服务的媒体ID",
        existing_nullable=True,
        schema="textloom_core",
    )
    op.alter_column(
        "tasks",
        "video_quality",
        existing_type=sa.VARCHAR(length=50),
        comment=None,
        existing_comment="视频质量",
        existing_nullable=True,
        schema="textloom_core",
    )
    op.alter_column(
        "tasks",
        "video_file_size",
        existing_type=sa.INTEGER(),
        comment=None,
        existing_comment="视频文件大小(字节)",
        existing_nullable=True,
        schema="textloom_core",
    )
    op.alter_column(
        "tasks",
        "video_duration",
        existing_type=sa.INTEGER(),
        comment=None,
        existing_comment="视频实际时长(秒)",
        existing_nullable=True,
        schema="textloom_core",
    )
    op.alter_column(
        "tasks",
        "thumbnail_url",
        existing_type=sa.TEXT(),
        comment=None,
        existing_comment="视频缩略图URL",
        existing_nullable=True,
        schema="textloom_core",
    )
    op.alter_column(
        "tasks",
        "video_url",
        existing_type=sa.TEXT(),
        comment=None,
        existing_comment="生成的视频URL",
        existing_nullable=True,
        schema="textloom_core",
    )
    op.alter_column(
        "tasks",
        "script_material_count",
        existing_type=sa.INTEGER(),
        comment=None,
        existing_comment="脚本使用素材数量",
        existing_nullable=True,
        schema="textloom_core",
    )
    op.alter_column(
        "tasks",
        "script_word_count",
        existing_type=sa.INTEGER(),
        comment=None,
        existing_comment="脚本字数",
        existing_nullable=True,
        schema="textloom_core",
    )
    op.alter_column(
        "tasks",
        "script_estimated_duration",
        existing_type=sa.INTEGER(),
        comment=None,
        existing_comment="脚本预计时长(秒)",
        existing_nullable=True,
        schema="textloom_core",
    )
    op.alter_column(
        "tasks",
        "script_tags",
        existing_type=postgresql.JSON(astext_type=sa.Text()),
        comment=None,
        existing_comment="脚本标签",
        existing_nullable=True,
        existing_server_default=sa.text("'[]'::json"),
        schema="textloom_core",
    )
    op.alter_column(
        "tasks",
        "script_narration",
        existing_type=sa.TEXT(),
        comment=None,
        existing_comment="脚本旁白内容",
        existing_nullable=True,
        schema="textloom_core",
    )
    op.alter_column(
        "tasks",
        "script_description",
        existing_type=sa.TEXT(),
        comment=None,
        existing_comment="脚本描述",
        existing_nullable=True,
        schema="textloom_core",
    )
    op.alter_column(
        "tasks",
        "script_title",
        existing_type=sa.TEXT(),
        comment=None,
        existing_comment="脚本标题",
        existing_nullable=True,
        schema="textloom_core",
    )
    op.alter_column(
        "tasks",
        "error_traceback",
        existing_type=sa.TEXT(),
        comment=None,
        existing_comment="详细错误堆栈信息",
        existing_nullable=True,
        schema="textloom_core",
    )
    op.alter_column(
        "tasks",
        "max_retries",
        existing_type=sa.INTEGER(),
        comment=None,
        existing_comment="最大重试次数",
        existing_nullable=True,
        existing_server_default=sa.text("3"),
        schema="textloom_core",
    )
    op.alter_column(
        "tasks",
        "retry_count",
        existing_type=sa.INTEGER(),
        comment=None,
        existing_comment="重试次数",
        existing_nullable=True,
        existing_server_default=sa.text("0"),
        schema="textloom_core",
    )
    op.alter_column(
        "tasks",
        "worker_name",
        existing_type=sa.VARCHAR(length=100),
        comment=None,
        existing_comment="执行任务的Worker名称",
        existing_nullable=True,
        schema="textloom_core",
    )
    op.alter_column(
        "tasks",
        "celery_task_id",
        existing_type=sa.VARCHAR(length=255),
        comment=None,
        existing_comment="Celery任务ID",
        existing_nullable=True,
        schema="textloom_core",
    )
    op.alter_column(
        "tasks",
        "error_message",
        existing_type=sa.TEXT(),
        comment=None,
        existing_comment="错误信息",
        existing_nullable=True,
        schema="textloom_core",
    )
    op.alter_column(
        "tasks",
        "completed_at",
        existing_type=postgresql.TIMESTAMP(),
        comment=None,
        existing_comment="完成时间",
        existing_nullable=True,
        schema="textloom_core",
    )
    op.alter_column(
        "tasks",
        "started_at",
        existing_type=postgresql.TIMESTAMP(),
        comment=None,
        existing_comment="开始时间",
        existing_nullable=True,
        schema="textloom_core",
    )
    op.alter_column(
        "tasks",
        "updated_at",
        existing_type=postgresql.TIMESTAMP(),
        nullable=False,
        comment=None,
        existing_comment="更新时间",
        existing_server_default=sa.text("CURRENT_TIMESTAMP"),
        schema="textloom_core",
    )
    op.alter_column(
        "tasks",
        "created_at",
        existing_type=postgresql.TIMESTAMP(),
        comment=None,
        existing_comment="创建时间",
        existing_nullable=False,
        existing_server_default=sa.text("CURRENT_TIMESTAMP"),
        schema="textloom_core",
    )
    op.alter_column(
        "tasks",
        "progress",
        existing_type=sa.INTEGER(),
        nullable=True,
        comment=None,
        existing_comment="任务进度",
        existing_server_default=sa.text("0"),
        schema="textloom_core",
    )
    op.alter_column(
        "tasks",
        "status",
        existing_type=sa.VARCHAR(length=50),
        comment=None,
        existing_comment="任务状态",
        existing_nullable=False,
        existing_server_default=sa.text("'pending'::character varying"),
        schema="textloom_core",
    )
    op.alter_column(
        "tasks",
        "task_type",
        existing_type=sa.VARCHAR(length=50),
        comment=None,
        existing_comment="任务类型",
        existing_nullable=False,
        schema="textloom_core",
    )
    op.alter_column(
        "tasks",
        "creator_id",
        existing_type=sa.VARCHAR(length=100),
        comment=None,
        existing_comment="创建者ID",
        existing_nullable=True,
        schema="textloom_core",
    )
    op.alter_column(
        "tasks",
        "description",
        existing_type=sa.TEXT(),
        comment=None,
        existing_comment="任务描述",
        existing_nullable=True,
        schema="textloom_core",
    )
    op.alter_column(
        "tasks",
        "title",
        existing_type=sa.VARCHAR(length=255),
        comment=None,
        existing_comment="任务标题",
        existing_nullable=False,
        schema="textloom_core",
    )
    op.alter_column(
        "sub_video_tasks",
        "completed_at",
        existing_type=postgresql.TIMESTAMP(),
        comment=None,
        existing_comment="完成时间",
        existing_nullable=True,
        schema="textloom_core",
    )
    op.alter_column(
        "sub_video_tasks",
        "updated_at",
        existing_type=postgresql.TIMESTAMP(),
        nullable=False,
        comment=None,
        existing_comment="更新时间",
        existing_server_default=sa.text("CURRENT_TIMESTAMP"),
        schema="textloom_core",
    )
    op.alter_column(
        "sub_video_tasks",
        "created_at",
        existing_type=postgresql.TIMESTAMP(),
        comment=None,
        existing_comment="创建时间",
        existing_nullable=False,
        existing_server_default=sa.text("CURRENT_TIMESTAMP"),
        schema="textloom_core",
    )
    op.alter_column(
        "sub_video_tasks",
        "error_message",
        existing_type=sa.TEXT(),
        comment=None,
        existing_comment="错误信息",
        existing_nullable=True,
        schema="textloom_core",
    )
    op.alter_column(
        "sub_video_tasks",
        "course_media_id",
        existing_type=sa.INTEGER(),
        comment=None,
        existing_comment="视频合成服务的媒体ID",
        existing_nullable=True,
        schema="textloom_core",
    )
    op.alter_column(
        "sub_video_tasks",
        "video_url",
        existing_type=sa.TEXT(),
        comment=None,
        existing_comment="生成的视频URL",
        existing_nullable=True,
        schema="textloom_core",
    )
    op.alter_column(
        "sub_video_tasks",
        "status",
        existing_type=sa.VARCHAR(length=50),
        comment=None,
        existing_comment="子任务状态",
        existing_nullable=False,
        existing_server_default=sa.text("'pending'::character varying"),
        schema="textloom_core",
    )
    op.alter_column(
        "sub_video_tasks",
        "video_index",
        existing_type=sa.INTEGER(),
        nullable=True,
        comment=None,
        existing_comment="视频索引",
        schema="textloom_core",
    )
    op.alter_column(
        "sub_video_tasks",
        "parent_task_id",
        existing_type=sa.UUID(),
        comment=None,
        existing_comment="父任务ID",
        existing_nullable=False,
        schema="textloom_core",
    )
    op.alter_column(
        "script_contents",
        "generated_at",
        existing_type=postgresql.TIMESTAMP(),
        comment=None,
        existing_comment="生成时间",
        existing_nullable=True,
        schema="textloom_core",
    )
    op.alter_column(
        "script_contents",
        "updated_at",
        existing_type=postgresql.TIMESTAMP(),
        nullable=False,
        comment=None,
        existing_comment="更新时间",
        existing_server_default=sa.text("CURRENT_TIMESTAMP"),
        schema="textloom_core",
    )
    op.alter_column(
        "script_contents",
        "created_at",
        existing_type=postgresql.TIMESTAMP(),
        comment=None,
        existing_comment="创建时间",
        existing_nullable=False,
        existing_server_default=sa.text("CURRENT_TIMESTAMP"),
        schema="textloom_core",
    )
    op.alter_column(
        "script_contents",
        "error_message",
        existing_type=sa.TEXT(),
        comment=None,
        existing_comment="错误信息",
        existing_nullable=True,
        schema="textloom_core",
    )
    op.alter_column(
        "script_contents",
        "ai_response",
        existing_type=sa.TEXT(),
        comment=None,
        existing_comment="AI响应",
        existing_nullable=True,
        schema="textloom_core",
    )
    op.alter_column(
        "script_contents",
        "generation_prompt",
        existing_type=sa.TEXT(),
        comment=None,
        existing_comment="生成提示词",
        existing_nullable=True,
        schema="textloom_core",
    )
    op.alter_column(
        "script_contents",
        "material_count",
        existing_type=sa.INTEGER(),
        comment=None,
        existing_comment="素材数量",
        existing_nullable=True,
        schema="textloom_core",
    )
    op.alter_column(
        "script_contents",
        "word_count",
        existing_type=sa.INTEGER(),
        comment=None,
        existing_comment="字数",
        existing_nullable=True,
        schema="textloom_core",
    )
    op.alter_column(
        "script_contents",
        "estimated_duration",
        existing_type=sa.INTEGER(),
        comment=None,
        existing_comment="预计时长(秒)",
        existing_nullable=True,
        schema="textloom_core",
    )
    op.alter_column(
        "script_contents",
        "tags",
        existing_type=postgresql.JSON(astext_type=sa.Text()),
        comment=None,
        existing_comment="标签",
        existing_nullable=True,
        existing_server_default=sa.text("'[]'::json"),
        schema="textloom_core",
    )
    op.alter_column(
        "script_contents",
        "description",
        existing_type=sa.TEXT(),
        comment=None,
        existing_comment="脚本描述",
        existing_nullable=True,
        schema="textloom_core",
    )
    op.alter_column(
        "script_contents",
        "material_mapping",
        existing_type=sa.JSON(),
        type_=postgresql.JSONB(astext_type=sa.Text()),
        comment=None,
        existing_comment="素材映射",
        existing_nullable=True,
        schema="textloom_core",
    )
    op.alter_column(
        "script_contents",
        "narration",
        existing_type=sa.Text(),
        type_=postgresql.JSONB(astext_type=sa.Text()),
        comment=None,
        existing_comment="旁白内容",
        existing_nullable=True,
        schema="textloom_core",
    )
    op.alter_column(
        "script_contents",
        "titles",
        existing_type=sa.JSON(),
        type_=postgresql.JSONB(astext_type=sa.Text()),
        comment=None,
        existing_comment="标题列表",
        existing_nullable=True,
        schema="textloom_core",
    )
    op.alter_column(
        "script_contents",
        "generation_status",
        existing_type=sa.VARCHAR(length=50),
        comment=None,
        existing_comment="生成状态",
        existing_nullable=False,
        existing_server_default=sa.text("'pending'::character varying"),
        schema="textloom_core",
    )
    op.alter_column(
        "script_contents",
        "script_style",
        existing_type=sa.String(length=50),
        type_=sa.VARCHAR(length=100),
        comment=None,
        existing_comment="脚本风格",
        existing_nullable=True,
        schema="textloom_core",
    )
    op.alter_column(
        "script_contents",
        "persona_id",
        existing_type=sa.UUID(),
        comment=None,
        existing_comment="关联人设ID",
        existing_nullable=True,
        schema="textloom_core",
    )
    op.alter_column(
        "script_contents",
        "task_id",
        existing_type=sa.UUID(),
        comment=None,
        existing_comment="关联任务ID",
        existing_nullable=False,
        schema="textloom_core",
    )
    op.alter_column(
        "prompt_templates",
        "created_at",
        existing_type=postgresql.TIMESTAMP(),
        comment=None,
        existing_comment="创建时间",
        existing_nullable=False,
        existing_server_default=sa.text("CURRENT_TIMESTAMP"),
        schema="textloom_core",
    )
    op.alter_column(
        "prompt_templates",
        "template_style",
        existing_type=sa.VARCHAR(length=50),
        comment=None,
        existing_comment="模板风格",
        existing_nullable=True,
        schema="textloom_core",
    )
    op.alter_column(
        "prompt_templates",
        "template_type",
        existing_type=sa.VARCHAR(length=50),
        comment=None,
        existing_comment="模板类型",
        existing_nullable=True,
        schema="textloom_core",
    )
    op.alter_column(
        "prompt_templates",
        "category",
        existing_type=sa.VARCHAR(length=50),
        comment=None,
        existing_comment="模板分类",
        existing_nullable=True,
        schema="textloom_core",
    )
    op.alter_column(
        "prompt_templates",
        "description",
        existing_type=sa.TEXT(),
        comment=None,
        existing_comment="模板描述",
        existing_nullable=True,
        schema="textloom_core",
    )
    op.alter_column(
        "prompt_templates",
        "template_content",
        existing_type=sa.TEXT(),
        comment=None,
        existing_comment="模板内容",
        existing_nullable=False,
        schema="textloom_core",
    )
    op.alter_column(
        "prompt_templates",
        "template_key",
        existing_type=sa.String(length=100),
        type_=sa.VARCHAR(length=255),
        comment=None,
        existing_comment="模板键名",
        existing_nullable=False,
        schema="textloom_core",
    )
    op.alter_column(
        "personas",
        "updated_at",
        existing_type=postgresql.TIMESTAMP(),
        comment=None,
        existing_comment="更新时间",
        existing_nullable=False,
        existing_server_default=sa.text("CURRENT_TIMESTAMP"),
        schema="textloom_core",
    )
    op.alter_column(
        "personas",
        "created_at",
        existing_type=postgresql.TIMESTAMP(),
        comment=None,
        existing_comment="创建时间",
        existing_nullable=False,
        existing_server_default=sa.text("CURRENT_TIMESTAMP"),
        schema="textloom_core",
    )
    op.alter_column(
        "personas",
        "is_preset",
        existing_type=sa.BOOLEAN(),
        nullable=False,
        comment=None,
        existing_comment="是否为预设人设",
        existing_server_default=sa.text("false"),
        schema="textloom_core",
    )
    op.alter_column(
        "personas",
        "custom_prompts",
        existing_type=sa.JSON(),
        type_=postgresql.JSONB(astext_type=sa.Text()),
        comment=None,
        existing_comment="自定义提示词",
        existing_nullable=True,
        existing_server_default=sa.text("'{}'::jsonb"),
        schema="textloom_core",
    )
    op.alter_column(
        "personas",
        "keywords",
        existing_type=sa.TEXT(),
        comment=None,
        existing_comment="关键词",
        existing_nullable=True,
        schema="textloom_core",
    )
    op.alter_column(
        "personas",
        "tone",
        existing_type=sa.VARCHAR(length=50),
        comment=None,
        existing_comment="语调",
        existing_nullable=True,
        schema="textloom_core",
    )
    op.alter_column(
        "personas",
        "characteristics",
        existing_type=sa.TEXT(),
        comment=None,
        existing_comment="特征描述",
        existing_nullable=True,
        schema="textloom_core",
    )
    op.alter_column(
        "personas",
        "target_audience",
        existing_type=sa.VARCHAR(length=100),
        comment=None,
        existing_comment="目标受众",
        existing_nullable=True,
        schema="textloom_core",
    )
    op.alter_column(
        "personas",
        "style",
        existing_type=sa.VARCHAR(length=100),
        comment=None,
        existing_comment="风格",
        existing_nullable=True,
        schema="textloom_core",
    )
    op.alter_column(
        "personas",
        "persona_type",
        existing_type=sa.VARCHAR(length=50),
        comment=None,
        existing_comment="人设类型",
        existing_nullable=False,
        schema="textloom_core",
    )
    op.alter_column(
        "personas",
        "name",
        existing_type=sa.VARCHAR(length=100),
        comment=None,
        existing_comment="人设名称",
        existing_nullable=False,
        schema="textloom_core",
    )
    op.alter_column(
        "media_items",
        "created_at",
        existing_type=postgresql.TIMESTAMP(),
        comment=None,
        existing_comment="创建时间",
        existing_nullable=False,
        existing_server_default=sa.text("CURRENT_TIMESTAMP"),
        schema="textloom_core",
    )
    op.alter_column(
        "media_items",
        "duration",
        existing_type=sa.Integer(),
        type_=sa.REAL(),
        comment=None,
        existing_comment="时长(秒)",
        existing_nullable=True,
        schema="textloom_core",
    )
    op.alter_column(
        "media_items",
        "mime_type",
        existing_type=sa.VARCHAR(length=100),
        comment=None,
        existing_comment="MIME类型",
        existing_nullable=True,
        schema="textloom_core",
    )
    op.alter_column(
        "media_items",
        "media_type",
        existing_type=sa.VARCHAR(length=50),
        comment=None,
        existing_comment="媒体类型",
        existing_nullable=False,
        schema="textloom_core",
    )
    op.alter_column(
        "media_items",
        "file_size",
        existing_type=sa.Integer(),
        type_=sa.BIGINT(),
        comment=None,
        existing_comment="文件大小(字节)",
        existing_nullable=True,
        schema="textloom_core",
    )
    op.alter_column(
        "media_items",
        "file_url",
        existing_type=sa.TEXT(),
        comment=None,
        existing_comment="文件URL",
        existing_nullable=False,
        schema="textloom_core",
    )
    op.alter_column(
        "media_items",
        "filename",
        existing_type=sa.VARCHAR(length=255),
        comment=None,
        existing_comment="文件名",
        existing_nullable=False,
        schema="textloom_core",
    )
    op.alter_column(
        "media_items",
        "task_id",
        existing_type=sa.UUID(),
        comment=None,
        existing_comment="关联任务ID",
        existing_nullable=False,
        schema="textloom_core",
    )
    op.drop_constraint(
        None, "material_analyses", schema="textloom_core", type_="foreignkey"
    )
    op.drop_constraint(
        "uq_material_analyses_task_file",
        "material_analyses",
        schema="textloom_core",
        type_="unique",
    )
    op.alter_column(
        "material_analyses",
        "updated_at",
        existing_type=postgresql.TIMESTAMP(),
        nullable=False,
        comment=None,
        existing_comment="更新时间",
        existing_server_default=sa.text("CURRENT_TIMESTAMP"),
        schema="textloom_core",
    )
    op.alter_column(
        "material_analyses",
        "created_at",
        existing_type=postgresql.TIMESTAMP(),
        comment=None,
        existing_comment="创建时间",
        existing_nullable=False,
        existing_server_default=sa.text("CURRENT_TIMESTAMP"),
        schema="textloom_core",
    )
    op.alter_column(
        "material_analyses",
        "error_message",
        existing_type=sa.TEXT(),
        comment=None,
        existing_comment="错误信息",
        existing_nullable=True,
        schema="textloom_core",
    )
    op.alter_column(
        "material_analyses",
        "model_version",
        existing_type=sa.VARCHAR(length=50),
        comment=None,
        existing_comment="使用的模型版本",
        existing_nullable=True,
        schema="textloom_core",
    )
    op.alter_column(
        "material_analyses",
        "processing_time",
        existing_type=sa.Float(),
        type_=sa.REAL(),
        comment=None,
        existing_comment="处理时间(秒)",
        existing_nullable=True,
        schema="textloom_core",
    )
    op.alter_column(
        "material_analyses",
        "color_palette",
        existing_type=postgresql.JSON(astext_type=sa.Text()),
        comment=None,
        existing_comment="主要颜色",
        existing_nullable=True,
        existing_server_default=sa.text("'[]'::json"),
        schema="textloom_core",
    )
    op.alter_column(
        "material_analyses",
        "dimensions",
        existing_type=sa.VARCHAR(length=20),
        comment=None,
        existing_comment="图像尺寸",
        existing_nullable=True,
        schema="textloom_core",
    )
    op.alter_column(
        "material_analyses",
        "key_frames",
        existing_type=postgresql.JSON(astext_type=sa.Text()),
        comment=None,
        existing_comment="关键帧信息",
        existing_nullable=True,
        existing_server_default=sa.text("'[]'::json"),
        schema="textloom_core",
    )
    op.alter_column(
        "material_analyses",
        "resolution",
        existing_type=sa.VARCHAR(length=20),
        comment=None,
        existing_comment="分辨率",
        existing_nullable=True,
        schema="textloom_core",
    )
    op.alter_column(
        "material_analyses",
        "fps",
        existing_type=sa.Float(),
        type_=sa.REAL(),
        comment=None,
        existing_comment="帧率",
        existing_nullable=True,
        schema="textloom_core",
    )
    op.alter_column(
        "material_analyses",
        "duration",
        existing_type=sa.INTEGER(),
        comment=None,
        existing_comment="视频时长(秒)",
        existing_nullable=True,
        schema="textloom_core",
    )
    op.alter_column(
        "material_analyses",
        "usage_suggestions",
        existing_type=postgresql.JSON(astext_type=sa.Text()),
        comment=None,
        existing_comment="使用建议",
        existing_nullable=True,
        existing_server_default=sa.text("'[]'::json"),
        schema="textloom_core",
    )
    op.alter_column(
        "material_analyses",
        "quality_level",
        existing_type=sa.VARCHAR(length=20),
        comment=None,
        existing_comment="质量级别",
        existing_nullable=True,
        schema="textloom_core",
    )
    op.alter_column(
        "material_analyses",
        "quality_score",
        existing_type=sa.Float(),
        type_=sa.REAL(),
        comment=None,
        existing_comment="质量评分",
        existing_nullable=True,
        schema="textloom_core",
    )
    op.alter_column(
        "material_analyses",
        "visual_style",
        existing_type=sa.VARCHAR(length=100),
        comment=None,
        existing_comment="视觉风格",
        existing_nullable=True,
        schema="textloom_core",
    )
    op.alter_column(
        "material_analyses",
        "emotional_tone",
        existing_type=sa.VARCHAR(length=100),
        comment=None,
        existing_comment="情感基调",
        existing_nullable=True,
        schema="textloom_core",
    )
    op.alter_column(
        "material_analyses",
        "key_objects",
        existing_type=postgresql.JSON(astext_type=sa.Text()),
        comment=None,
        existing_comment="识别的关键对象",
        existing_nullable=True,
        existing_server_default=sa.text("'[]'::json"),
        schema="textloom_core",
    )
    op.alter_column(
        "material_analyses",
        "extracted_text",
        existing_type=sa.TEXT(),
        comment=None,
        existing_comment="提取的文本内容",
        existing_nullable=True,
        schema="textloom_core",
    )
    op.alter_column(
        "material_analyses",
        "ai_description",
        existing_type=sa.TEXT(),
        comment=None,
        existing_comment="AI生成的描述",
        existing_nullable=True,
        schema="textloom_core",
    )
    op.alter_column(
        "material_analyses",
        "status",
        existing_type=sa.VARCHAR(length=50),
        comment=None,
        existing_comment="分析状态",
        existing_nullable=False,
        existing_server_default=sa.text("'pending'::character varying"),
        schema="textloom_core",
    )
    op.alter_column(
        "material_analyses",
        "file_size",
        existing_type=sa.INTEGER(),
        comment=None,
        existing_comment="文件大小",
        existing_nullable=True,
        schema="textloom_core",
    )
    op.alter_column(
        "material_analyses",
        "file_type",
        existing_type=sa.VARCHAR(length=50),
        comment=None,
        existing_comment="文件类型",
        existing_nullable=False,
        schema="textloom_core",
    )
    op.alter_column(
        "material_analyses",
        "file_url",
        existing_type=sa.TEXT(),
        comment=None,
        existing_comment="文件URL",
        existing_nullable=False,
        schema="textloom_core",
    )
    op.alter_column(
        "material_analyses",
        "media_item_id",
        existing_type=sa.UUID(),
        comment=None,
        existing_comment="关联媒体项目ID",
        existing_nullable=True,
        schema="textloom_core",
    )
    op.alter_column(
        "material_analyses",
        "task_id",
        existing_type=sa.UUID(),
        comment=None,
        existing_comment="关联任务ID",
        existing_nullable=False,
        schema="textloom_core",
    )
    op.create_table(
        "schema_migrations",
        sa.Column("id", sa.INTEGER(), autoincrement=True, nullable=False),
        sa.Column(
            "migration_name",
            sa.VARCHAR(length=255),
            autoincrement=False,
            nullable=False,
        ),
        sa.Column(
            "applied_at",
            postgresql.TIMESTAMP(),
            server_default=sa.text("CURRENT_TIMESTAMP"),
            autoincrement=False,
            nullable=False,
        ),
        sa.Column("description", sa.TEXT(), autoincrement=False, nullable=True),
        sa.PrimaryKeyConstraint("id", name=op.f("schema_migrations_pkey")),
        sa.UniqueConstraint(
            "migration_name",
            name=op.f("schema_migrations_migration_name_key"),
            postgresql_include=[],
            postgresql_nulls_not_distinct=False,
        ),
        schema="textloom_core",
    )
    # ### end Alembic commands ###
